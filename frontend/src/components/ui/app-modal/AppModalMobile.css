/**
 * AppModal - Mobile & Responsive Styles
 *
 * Mobile bottom sheet behavior, responsive adjustments, and touch-friendly form inputs.
 */

/* Forms & MyCompany modal fixes: See AppModalMobileForms.css */
@import url('./AppModalMobileForms.css');

/* ===========================================
   Responsive adjustments (≤640px)
   =========================================== */

@media (width <= 640px) {
  .app-modal-content {
    width: 95%;
    max-height: 90vh;
  }

  .app-modal-header {
    padding: var(--space-3-5) var(--space-4);
  }

  .app-modal-body {
    padding: var(--space-4);
  }

  .app-modal-footer {
    padding: var(--space-4);
    gap: var(--gap-sm);
  }

  /* Footer with actions - stack on mobile */
  .app-modal-footer-with-actions {
    flex-direction: column;
    gap: var(--gap);
    padding: var(--space-3) var(--space-4);
  }

  .app-modal-footer-left {
    width: 100%;
    flex-wrap: wrap;
    justify-content: center;
    gap: var(--gap-sm);
  }

  .app-modal-footer-right {
    width: 100%;
    justify-content: center;
  }

  /* Buttons - full width on mobile */
  .app-modal-btn {
    min-height: 44px;
    padding: var(--space-3) var(--space-4);
  }

  .app-modal-btn-action {
    min-height: 44px;
    padding: var(--space-2-5) var(--space-3-5);
    flex: 1;
    justify-content: center;
  }

  /* Inline confirm - stack buttons */
  .app-modal-confirm-inline {
    flex-wrap: wrap;
    justify-content: center;
    gap: var(--gap-sm);
    width: 100%;
  }

  .app-modal-confirm-inline span {
    width: 100%;
    text-align: center;
    font-size: var(--text-sm);
  }

  .app-modal-confirm-inline button {
    flex: 1;
    min-width: 80px;
  }
}

/* ===========================================
   Mobile Bottom Sheet Behavior (≤640px)
   Transform centered modals into bottom sheets
   =========================================== */

@media (width <= 640px) {
  /* Modal slides up from bottom like iOS/Android */
  .app-modal-content {
    position: fixed;
    inset: auto 0 0;
    transform: none;
    width: 100%;
    max-width: none;
    border-radius: var(--radius-2xl) var(--radius-2xl) 0 0;

    /* Use max-height to constrain, let content determine actual height */
    max-height: 95dvh;
    max-height: calc(95dvh - env(safe-area-inset-top, 0px));
    animation: app-modal-slide-up 250ms ease-out;

    /* Ensure flex layout constraints children properly */
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .app-modal-content[data-state='closed'] {
    animation: app-modal-slide-down 200ms ease-in;
  }

  /* Clickable drag handle area - tap to close */
  .app-modal-drag-handle {
    position: absolute;
    inset-block-start: 0;
    right: 0;
    height: 32px;
    cursor: pointer;
    z-index: calc(var(--z-elevated) + 1);
    display: flex;
    align-items: center;
    justify-content: center;
    -webkit-tap-highlight-color: transparent;
  }

  /* Visual drag handle bar (inside the clickable area) */
  .app-modal-drag-handle::before {
    content: '';
    width: 36px;
    height: 4px;
    background: var(--color-slate-300);
    border-radius: var(--radius-xs);
    transition: background 0.15s ease;
  }

  .app-modal-drag-handle:hover::before,
  .app-modal-drag-handle:active::before {
    background: var(--color-slate-400);
  }

  /* Dark mode drag handle - more visible */
  .dark .app-modal-drag-handle::before,
  [data-theme='dark'] .app-modal-drag-handle::before {
    background: var(--color-slate-500);
  }

  .dark .app-modal-drag-handle:hover::before,
  .dark .app-modal-drag-handle:active::before,
  [data-theme='dark'] .app-modal-drag-handle:hover::before,
  [data-theme='dark'] .app-modal-drag-handle:active::before {
    background: var(--color-slate-400);
  }

  /* Hide the old pseudo-element since we have a real element now */
  .app-modal-content::before {
    display: none;
  }

  /* Header - MUST stay visible, never scrolls away */
  .app-modal-header {
    padding-top: var(--space-6);
    flex-shrink: 0;
    position: relative;
    z-index: var(--z-base);
    background: var(--color-bg-primary);
  }

  /* Dark mode header background on mobile */
  .dark .app-modal-header,
  [data-theme='dark'] .app-modal-header {
    background: var(--color-bg-secondary);
  }

  /* Body - fills available space and scrolls */
  .app-modal-body {
    flex: 1 1 0;
    min-height: 0;
    overflow: hidden auto;
    -webkit-overflow-scrolling: touch;
  }

  /* ONLY when body has mc-modal-no-padding, it contains its own header/body/footer structure
     and needs to be a flex container. Other modals (like Settings) should NOT get this. */
  .app-modal-body.mc-modal-no-padding {
    padding: 0;

    /* This container must be a flex column so children can flex properly */
    display: flex;
    flex-direction: column;

    /* Don't scroll at this level - let inner .mc-modal-body scroll */
    overflow: hidden;
  }

  /* MyCompany modals need explicit height for flex children to calculate.
     Use :has() to target the parent container when it has mc-modal-no-padding body. */
  .app-modal-content:has(.mc-modal-no-padding) {
    height: 90dvh;
    height: calc(90dvh - env(safe-area-inset-top, 0px));
  }

  /* Settings modal - has its own fixed-height layout, just needs padding removed.
     SettingsLayout.css handles the internal flex layout with fixed heights for consistency. */
  .app-modal-body.settings-modal-body {
    padding: 0;
  }

  /* Footer respects safe area */
  .app-modal-footer,
  .app-modal-footer-with-actions {
    flex-shrink: 0;
    padding-bottom: calc(var(--space-4) + env(safe-area-inset-bottom, 0px));
  }

  /* Full-size modals take more space on mobile */
  .app-modal-full {
    max-height: 100dvh;
    max-height: calc(100dvh - env(safe-area-inset-top, 20px));
    height: 100dvh;
    height: calc(100dvh - env(safe-area-inset-top, 20px));
    border-radius: var(--radius-2xl) var(--radius-2xl) 0 0;
  }

  /* Close button gets 44px touch target */
  .app-modal-close {
    width: 44px;
    height: 44px;
    min-width: 44px;
    min-height: 44px;
  }

  /* Footer buttons get 44px touch target */
  .app-modal-btn {
    min-height: 44px;
    padding: var(--space-3) var(--space-5);
  }
}

/* Slide up animation for bottom sheet */
@keyframes app-modal-slide-up {
  from {
    opacity: 0;
    transform: translateY(100%);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes app-modal-slide-down {
  from {
    opacity: 1;
    transform: translateY(0);
  }

  to {
    opacity: 0;
    transform: translateY(100%);
  }
}

/* Very small phones - full screen modal */
@media (width <= 640px) {
  .app-modal-content {
    border-radius: var(--radius-xl) var(--radius-xl) 0 0;
  }

  .app-modal-lg,
  .app-modal-xl,
  .app-modal-full {
    max-height: 100dvh;
    max-height: calc(100dvh - env(safe-area-inset-top, 0px));
    border-radius: 0;
  }

  .app-modal-lg::before,
  .app-modal-xl::before,
  .app-modal-full::before {
    display: none; /* No drag handle for full-screen */
  }

  .app-modal-lg .app-modal-header,
  .app-modal-xl .app-modal-header,
  .app-modal-full .app-modal-header {
    padding-top: calc(var(--space-4) + env(safe-area-inset-top, 0px));
  }
}

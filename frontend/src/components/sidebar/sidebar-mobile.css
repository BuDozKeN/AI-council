/* =============================================================================
   MOBILE SIDEBAR
   ============================================================================= */

@media (width <= 640px) {
  /* Mobile sidebar - full-width drawer overlay */
  .sidebar.sidebar--collapsed,
  .sidebar.sidebar--hovered,
  .sidebar.sidebar--pinned,
  .sidebar {
    position: fixed;
    left: 0;
    top: 0;
    width: 100%;
    max-width: 100%;
    min-width: auto;
    height: 100vh;
    height: 100dvh; /* Dynamic viewport height for mobile browsers */
    z-index: var(--z-modal);
    transform: translateX(-100%);
    box-shadow: none;

    /* CRITICAL: Ensure flex layout properly constrains children */
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .sidebar.mobile-open {
    transform: translateX(0);
    box-shadow: none; /* No shadow needed for full-width */
  }
}

@media (width <= 640px) {
  /* Full-width mobile drawer overlay */
  .sidebar.sidebar--collapsed,
  .sidebar.sidebar--hovered,
  .sidebar.sidebar--pinned,
  .sidebar {
    width: 100%;
    max-width: 100%;
  }
}

/* Mobile layout adjustments */
@media (width <= 640px) {
  /* Hide icon rail on mobile - show expanded content instead */
  .sidebar .sidebar-icon-rail {
    display: none;
  }

  /* Hide pin toggle on mobile - not relevant */
  .sidebar .sidebar-pin-btn {
    display: none;
  }

  /* Main content is column layout on mobile - must constrain height */
  .sidebar .sidebar-main {
    flex-direction: column;

    /* CRITICAL: Use flex shorthand to constrain height properly */
    flex: 1 1 0;
    min-height: 0;
    overflow: hidden;
  }

  /* Expanded panel takes remaining space and scrolls internally */
  .sidebar .sidebar-expanded-panel {
    border-left: none;

    /* CRITICAL: Constrain height so it doesn't push footer off screen */
    flex: 1 1 0;
    min-height: 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  /* Conversation list scrolls, not the panel */
  .sidebar .conversation-list {
    flex: 1 1 0;
    min-height: 0;
    overflow: hidden auto;
    -webkit-overflow-scrolling: touch;
  }

  /* Panel controls stay fixed at top */
  .sidebar .sidebar-panel-controls {
    flex-shrink: 0;
  }

  /* Header takes full width with New Chat button */
  .sidebar .sidebar-header {
    padding: var(--space-3) var(--space-4);
    flex-shrink: 0;
  }

  .sidebar .sidebar-new-btn {
    flex: 1;
    min-height: 44px; /* WCAG touch target */
    height: 44px;
  }

  /* Footer - always visible at bottom on mobile */
  .sidebar .sidebar-footer {
    flex-shrink: 0;
    padding: var(--space-3) var(--space-4);
    padding-bottom: calc(var(--space-3) + env(safe-area-inset-bottom, 0px));
    background: var(--sidebar-bg);
    border-top: 1px solid var(--sidebar-border);
  }

  /* Make footer buttons touch-friendly */
  .sidebar .sidebar-footer-btn,
  .sidebar .sign-out-btn {
    min-height: 44px;
    padding: var(--space-2-5) var(--space-3);
  }

  /* Make all footer action buttons touch-friendly */
  .sidebar .sidebar-footer .company-btn,
  .sidebar .sidebar-footer .settings-btn {
    min-height: 44px;
    padding: var(--space-2-5) var(--space-3);
  }
}

/* =============================================================================
   MOBILE TOUCH TARGET FIXES (P0)
   ============================================================================= */

@media (width <= 640px) {
  /* ==========================================================================
     MOBILE SWIPEABLE CONVERSATION ITEMS - Compact spacing
     ========================================================================== */

  /* SwipeableRow container - compact spacing */
  .sidebar .swipeable-row-container {
    margin: var(--space-px) var(--space-2);
    border-radius: var(--radius-md);
  }

  /* Inner content - compact but touch-friendly */
  .conversation-item-inner {
    display: flex;
    align-items: center;
    width: 100%;
    padding: var(--space-2) var(--space-3);
    min-height: 44px;
    gap: var(--gap-sm);
    background: var(--sidebar-bg);
    border-radius: var(--radius-md);
    -webkit-touch-callout: none;
    user-select: none;
  }

  /* Active state */
  .conversation-item-swipeable.active .conversation-item-inner {
    background: var(--sidebar-active-bg);
    border-radius: var(--radius-md);
  }

  /* Content full width */
  .conversation-item-inner .conversation-content {
    flex: 1;
    min-width: 0;
    max-width: 100%;
  }

  /* ==========================================================================
     LEGACY CONVERSATION ITEMS - Compact spacing
     ========================================================================== */

  .conversation-item {
    padding: var(--space-2-5) var(--space-3);
    margin: 0;
    flex-wrap: nowrap;
    -webkit-touch-callout: none;
    user-select: none;
  }

  /* Full width for content on mobile */
  .sidebar .conversation-item .conversation-content,
  .sidebar .conversation-item:hover .conversation-content,
  .sidebar .conversation-item:active .conversation-content {
    max-width: 100%;
  }

  /* Touch feedback */
  .sidebar .conversation-item:active {
    background: var(--sidebar-hover-bg);
  }

  /* HIDE hover actions on mobile - use swipe instead */
  .sidebar .hover-actions,
  .conversation-list .hover-actions {
    display: none;
    visibility: hidden;
  }

  /* Starred indicator */
  .sidebar .conversation-item.starred .title-star,
  .conversation-item-swipeable.starred .title-star {
    display: inline-flex;
    margin-left: var(--space-1);
  }

  /* Make bulk action bar touch-friendly on mobile */
  .sidebar .bulk-action-bar {
    margin: 0 var(--space-4) var(--space-4);
    padding: var(--space-3) var(--space-4);
  }

  .sidebar .bulk-cancel-btn,
  .sidebar .bulk-delete-btn {
    min-height: 44px;
    padding: var(--space-2) var(--space-4);
  }

  /* Filter row - better spacing on mobile
     Note: Touch-friendly trigger sizes are handled by select.css compact variant */
  .sidebar-filter {
    padding: var(--space-2) var(--space-4);
    gap: var(--gap-sm);
  }

  /* Make search input touch-friendly */
  .search-input {
    min-height: 44px;
    padding: var(--space-3) var(--space-8) var(--space-3) var(--space-10);
    font-size: var(--text-base); /* Prevents iOS zoom on focus */
    border-radius: var(--radius-lg);
  }

  /* Larger search icon on mobile */
  .search-icon {
    left: 14px;
    width: 18px;
    height: 18px;
  }

  /* Larger clear button on mobile */
  .search-clear {
    right: 10px;
    width: 24px;
    height: 24px;
    font-size: var(--text-base);
  }

  /* More padding around search on mobile */
  .sidebar-search {
    padding: var(--space-3) var(--space-4);
  }

  /* Make load more button touch-friendly */
  .load-more-btn {
    min-height: 44px;
    padding: var(--space-3) var(--space-4);
  }

  /* Make group headers touch-friendly */
  .group-header {
    min-height: 44px;
    padding: var(--space-2-5) var(--space-3);
    margin: var(--space-3) var(--space-2) var(--space-1-5);
  }

  .group-name {
    font-size: var(--text-xs);
  }

  .group-count {
    font-size: var(--text-xs);
    padding: var(--space-1) var(--space-2);
  }

  /* Firefox scrollbar support */
  .conversation-list {
    scrollbar-width: thin;
    scrollbar-color: var(--sidebar-scrollbar-thumb) var(--sidebar-scrollbar-track);
  }
}

/* =============================================================================
   LANDSCAPE ORIENTATION SUPPORT
   ============================================================================= */

@media (width <= 1024px) and (orientation: landscape) {
  .sidebar.sidebar--collapsed,
  .sidebar.sidebar--hovered,
  .sidebar.sidebar--pinned,
  .sidebar {
    width: 240px;
    max-width: 240px;
  }
}

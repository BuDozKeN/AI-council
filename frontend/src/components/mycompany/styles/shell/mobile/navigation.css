/**
 * MyCompany Mobile Shell - Navigation Styles
 * Bottom navigation tabs, back button, mobile TOC
 *
 * Key features:
 * - Bottom navigation tabs (thumb zone)
 * - Mobile back button
 * - TOC visibility toggles
 */

/* Back button: See navigation-back.css */
@import url('./navigation-back.css');

/* ============================================================================
   MOBILE TOC - Hidden on desktop, shown on mobile
   ============================================================================ */

/* Mobile TOC trigger - show on mobile, hide on desktop (sticky variant is used instead) */
@media (width >= 641px) {
  .mc-mobile-toc.stage3-mobile-toc-trigger {
    display: none;
  }
}

/* ============================================================================
   P0-1: BOTTOM NAVIGATION TABS (â‰¤640px)
   Move tabs from mid-screen to bottom for thumb reach

   Strategy: Flex equal distribution (flex: 1 1 0)
   - Tabs share space evenly regardless of count (5, 7, 8, etc.)
   - Labels truncate with ellipsis if needed
   - Works well for 4-8 tabs; beyond 8 consider a "More" menu
   ============================================================================ */

@media (width <= 640px) {
  /* Restructure panel layout for bottom nav */
  .mc-panel {
    display: flex;
    flex-direction: column;
    width: 100%;
    height: 100%;
    max-height: 100%;
    border-radius: 0;
  }

  /* Match header background on mobile - needs dark mode specificity to override shell-tabs.css */
  .dark .mc-panel,
  [data-theme='dark'] .mc-panel {
    background: var(--color-bg-inverse);
  }

  /* Move tabs to bottom - iOS-style tab bar (doubled selector for specificity) */
  .mc-tabs.mc-tabs {
    order: 3;
    position: relative; /* Wrapper handles fixed positioning */
    width: 100%;
    background: var(--color-bg-inverse);
    border: none;
    border-radius: var(--radius-xl);
    padding: var(--space-2) var(--space-2) calc(8px + env(safe-area-inset-bottom, 0px));
    display: flex;
    flex-wrap: nowrap;
    justify-content: flex-start;
    gap: var(--gap-xs);
    box-shadow: var(--shadow-lg);
    overflow: auto hidden;
    box-sizing: border-box;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none; /* Firefox */
  }

  .mc-tabs.mc-tabs::-webkit-scrollbar {
    display: none; /* Hide scrollbar */
  }

  /* Tabs wrapper - positions the fade indicator */
  .mc-tabs-wrapper {
    position: fixed;
    bottom: 12px;
    left: 12px;
    right: 12px;
    z-index: var(--z-dropdown);
  }

  /* Scroll indicator - fade gradient on right edge to hint at more tabs */
  .mc-tabs-fade {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    width: 48px;
    background: linear-gradient(to right, transparent, var(--color-bg-inverse) 70%);
    border-radius: 0 var(--radius-xl) var(--radius-xl) 0;
    pointer-events: none;
    z-index: var(--z-above);
    opacity: 1;
    transition: opacity 0.2s ease;
  }

  /* Hide scroll indicator when scrolled to end */
  .mc-tabs-fade.hidden {
    opacity: 0;
  }

  /* Remove pseudo-element - using real element now */
  .mc-tabs.mc-tabs::after {
    display: none;
  }

  /* Tab style: icon + label stacked (iOS tab bar style) - doubled selector for specificity */
  .mc-tab.mc-tab {
    flex: 0 0 auto; /* Don't grow or shrink - use natural width */
    flex-direction: column;
    gap: var(--gap-2xs);
    padding: var(--space-1-5) var(--space-2);
    min-width: 64px; /* Ensure minimum tap target width */
    max-width: none;
    min-height: 44px;
    border-radius: var(--radius-md);
    align-items: center;
    justify-content: center;
    overflow: visible; /* Allow labels to show */
    box-sizing: border-box;
    color: var(--color-text-inverse);
    opacity: 0.7;
    background: transparent;
    white-space: nowrap; /* Prevent label wrapping */
  }

  .mc-tab:hover {
    opacity: 0.9;
    background: var(--overlay-white-10);
  }

  /* Show labels on bottom nav - full width, no truncation */
  .mc-tab-label {
    display: block;
    font-size: var(--text-xs);
    font-weight: 500;
    letter-spacing: 0;
    white-space: nowrap;
    overflow: visible;
  }

  .mc-tab-icon {
    width: 18px;
    height: 18px;
  }

  .mc-tab-icon svg {
    width: 18px;
    height: 18px;
  }

  /* Active state for bottom nav */
  .mc-tab.active {
    background: var(--color-indigo-600);
    color: var(--color-text-inverse);
    opacity: 1;
  }

  .mc-tab.active::after {
    display: none; /* Remove underline indicator */
  }

  /* Add padding to content to account for floating bottom nav */
  .mc-content {
    padding: var(--space-3) var(--space-4);
    padding-bottom: calc(80px + env(safe-area-inset-bottom, 0px));
    order: 2;

    /* Ensure content fills available height AND width */
    flex: 1;
    min-height: 0;
    min-width: 0; /* CRITICAL: Allow flex shrinking below content size */
    width: 100%;
    max-width: 100%;
    display: flex;
    flex-direction: column;
    overflow: hidden; /* Contain children within bounds */
  }

  /* Header stays at top */
  .mc-header {
    order: 1;
  }

  /* Add drag handle indicator at top of panel (swipe down to close) */
  .mc-panel::before {
    content: '';
    position: absolute;
    inset-block-start: 6px;
    left: 50%;
    transform: translateX(-50%);
    width: 36px;
    height: 4px;
    background: var(--overlay-white-50); /* White for dark header */
    border-radius: var(--radius-xs);
    z-index: var(--z-above);
  }

  /* Adjust header padding to account for drag handle */
  .mc-header {
    padding-block: var(--space-5) var(--space-3);
  }

  /* Compact header on mobile */
  .mc-header h1 {
    font-size: 1rem;
  }

  .mc-title-suffix {
    font-size: 0.75rem;
  }

  /* Hide company switcher label, show icon only */
  .mc-company-switcher {
    margin-top: var(--space-1);
  }

  /* Make close button smaller on mobile */
  .mc-close-btn {
    font-size: 1.25rem;
  }

  /* Prevent browser back gesture and scroll bounce */
  .mc-panel {
    overscroll-behavior: none;
    touch-action: pan-y pinch-zoom;
  }

  .mc-overlay {
    overscroll-behavior: none;
    touch-action: none;
  }

  /* Bottom nav should not trigger scroll when touched */
  .mc-tabs {
    touch-action: manipulation;
    overscroll-behavior: none;
  }
}

/* Mobile back button base styles: See navigation-back.css */

/* Show on mobile, position back button, keep company switcher */
@media (width <= 640px) {
  .mc-mobile-back-btn {
    display: flex;
    position: absolute;
    left: 12px;
    inset-block-start: 50%;
    transform: translateY(-50%);
    z-index: var(--z-elevated);
  }

  .mc-dismiss-hint {
    display: none;
  }

  /* Mobile header layout - stack vertically, center content */
  .mc-header {
    flex-direction: column;
    align-items: center;
    gap: var(--gap-sm-plus);
    padding-top: var(--space-5);
  }

  /* Remove rounded corners on header - prevents white gaps at top corners on mobile */
  .mc-header-dismissible {
    border-radius: 0;
  }

  /* Hide title row on mobile, just show company switcher */
  .mc-title-row {
    display: none;
  }

  /* Company switcher takes center stage on mobile */
  .mc-company-switcher {
    order: -1;
  }

  /* Hide desktop close button on mobile (use back button instead) */
  .mc-close-btn {
    display: none;
  }
}

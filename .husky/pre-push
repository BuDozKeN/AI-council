#!/bin/sh
# Pre-push hook: Run full lint, type-check, and tests before pushing
# This catches errors before they hit CI

echo "ğŸ” Running pre-push checks..."

# ============================================
# BACKEND TESTS
# ============================================
echo ""
echo "ğŸ Running backend tests..."
python -m pytest backend/tests/ -v --tb=short -q
if [ $? -ne 0 ]; then
  echo "âŒ Backend tests failed. Fix errors before pushing."
  exit 1
fi
echo "âœ… Backend tests passed!"

# ============================================
# FRONTEND CHECKS
# ============================================
cd frontend

# Run ESLint on entire codebase
echo ""
echo "ğŸ“ Running ESLint..."
npm run lint --silent
if [ $? -ne 0 ]; then
  echo "âŒ ESLint failed. Fix errors before pushing."
  exit 1
fi

# Run TypeScript type-check
echo ""
echo "ğŸ“˜ Running TypeScript check..."
npm run type-check --silent
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript check failed. Fix errors before pushing."
  exit 1
fi

# Run frontend unit tests
echo ""
echo "ğŸ§ª Running frontend tests..."
npm run test:run --silent
if [ $? -ne 0 ]; then
  echo "âŒ Frontend tests failed. Fix errors before pushing."
  exit 1
fi

echo ""
echo "âœ… All pre-push checks passed! Pushing..."

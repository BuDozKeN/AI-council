# Technical Debt Remediation Baseline

> **Captured:** 2026-02-05
> **Purpose:** Reference snapshot for regression prevention. Numbers can only go DOWN.

## Frontend

| Metric | Baseline Value | Gate Direction |
|--------|---------------|----------------|
| **Lint** | 0 errors, 59 warnings | Errors must stay 0, warnings must not increase |
| **Type-check** | 0 errors (clean pass) | Must stay 0 |
| **Tests** | 19 suites, 295 tests, all passing | Count must not decrease |
| **Build** | Passes (9.88s) | Must always pass |
| **Bundle: main chunk** | 1,274.95 KB (gzip: 388.31 KB) | Must not increase >5% |
| **Bundle: AdminPortal chunk** | 130.15 KB (gzip: 32.38 KB) | Should decrease after split |

### Code Quality Counts

| Metric | Count | Files | Gate |
|--------|-------|-------|------|
| `eslint-disable` comments | **57** | 40 files | Must not increase |
| `: any` type annotations | **0** | 0 files | Must stay 0 |
| `as any` casts | **0** | 0 files | Must stay 0 |
| CSS files > 300 lines | **8** | See list below (3 infra, 2 huge, 3 borderline) | Must not increase |
| Total source CSS | **1,375,972 bytes** (~1,344 KB) | Budget: 1,350 KB | 6KB under |

### eslint-disable Breakdown (top offenders)

| File | Count |
|------|-------|
| UsersTab.tsx | 6 |
| MyCompany.tsx | 2 |
| Organization.tsx | 3 |
| PlaybooksTab.tsx | 3 |
| App.tsx | 2 |
| CommandPalette.tsx | 2 |
| ImpersonateUserModal.tsx | 2 |
| ProjectModal.tsx | 2 |
| TableOfContents.tsx | 2 |
| ViewProjectModal.tsx | 2 |
| useCompanyData.ts | 2 |
| (31 files with 1 each) | 31 |

### CSS Budget Violators (>300 lines)

| File | Lines | Category |
|------|-------|----------|
| OmniBar.module.css | 1,724 | Huge (needs dedicated refactoring) |
| tailwind.css | 1,491 | Infrastructure (exempt) |
| ChatInput.module.css | 1,416 | Huge (needs dedicated refactoring) |
| index.css | 568 | Infrastructure (exempt) |
| design-tokens.css | 553 | Infrastructure (exempt) |
| sidebar-conversations.css | 310 | Borderline (accepted) |
| toc-mobile.css | 307 | Borderline (accepted) |
| TeamSection.css | 303 | Borderline (accepted) |

Files resolved by splitting (2026-02-05):
- ResponseStyleSelector.module.css (427→272) → dark/mobile to ResponseStyleSelectorDark.module.css
- sidebar-mobile.css (392→286) → small screens to sidebar-mobile-small.css
- SettingsResponsive.css (325→256) → small phone breakpoints to SettingsResponsiveSmall.css
- Login.css (323→237) → aurora animation to LoginAurora.css
- Skeleton.css (315→249) → conversation skeleton to SkeletonConversation.css
- project-list.css (312→244) → modal meta to project-list-meta.css
- AdminPortal.css (312→239) → search/placeholder to AdminPortalPlaceholder.css

---

## Backend

| Metric | Baseline Value | Gate Direction |
|--------|---------------|----------------|
| **Tests** | 412 passed, 0 failed, 0 warnings | Count must not decrease |
| **Test Duration** | 25.06s | Informational only |

### Code Quality Counts

| Metric | Count | Files | Gate |
|--------|-------|-------|------|
| `except Exception` handlers (total) | **299** | 52 files | Must not increase |
| `except Exception:` bare/silent | **1** | 1 file (test only) | Must not increase |
| `get_supabase_service()` calls | **129** | 23 files | Must not increase |
| `supabase_service` references | **135** | 24 files | Informational |
| `service_client` references | **110** | 17 files | Informational |

### except Exception Breakdown (top offenders)

| File | Count |
|------|-------|
| routers/admin.py | 35 |
| routers/conversations.py | 24 |
| routers/projects.py | 17 |
| routers/knowledge.py | 16 |
| cache.py | 13 |
| vector_store.py | 12 |
| routers/company/utils.py | 12 |
| storage.py | 11 |
| routers/settings.py | 10 |
| context_loader.py | 10 |
| attachments.py | 10 |

### get_supabase_service() Breakdown (top offenders)

| File | Count | Category |
|------|-------|----------|
| routers/admin.py | 23 | Admin ops (likely valid) |
| tests/test_onboarding.py | 12 | Test (acceptable) |
| llm_config.py | 8 | Needs audit |
| services/trial.py | 8 | Background job (needs audit) |
| tests/test_billing.py | 7 | Test (acceptable) |
| knowledge.py | 7 | Needs audit |
| context_loader.py | 7 | Needs audit |
| context_loader_impl.py | 6 | Needs audit |
| attachments.py | 6 | Needs audit |

---

## Deprecation Warnings (Backend)

- ~~`supafunc` package deprecated~~ — **Resolved** (upgraded supabase 2.16.0 → 2.18.1, now uses `supabase_functions`)
- ~~`datetime.utcnow()` deprecated~~ — **Resolved** (all instances migrated to `datetime.now(timezone.utc)`)
- ~~`datetime.fromtimestamp()` naive local time bug~~ — **Resolved** (billing.py lines 386, 418-420 now use `tz=timezone.utc`)

---

## How to Use This Baseline

### Before Each PR

```bash
# Frontend checks
cd frontend
npm run lint 2>&1 | tail -5          # Must show: 0 errors
npm run type-check                    # Must show: clean
npm run test:run 2>&1 | tail -5      # Must show: >= 295 tests passing
npm run build                         # Must pass

# Backend checks
cd backend
python -m pytest --tb=short 2>&1 | tail -5  # Must show: >= 412 passed
```

### After Each PR (ratchet check)

```bash
# These numbers must be <= baseline (or updated baseline if item reduced them)
grep -rn "eslint-disable" frontend/src/ --include="*.tsx" --include="*.ts" | wc -l   # <= 57
grep -rn ": any" frontend/src/ --include="*.tsx" --include="*.ts" | wc -l            # = 0
grep -rn "as any" frontend/src/ --include="*.tsx" --include="*.ts" | wc -l           # = 0
grep -rn "except Exception" backend/ --include="*.py" | wc -l                        # <= 298
grep -rn "get_supabase_service" backend/ --include="*.py" | wc -l                    # <= 129
```

### Updating This Baseline

After a successful remediation item reduces a count:
1. Update the number in this file
2. Update the GUARD-5 gate script in the remediation plan
3. Commit both changes
4. The new lower number becomes the floor - it can never go back up
